# Microsoft.ServiceFabric
  
> [!NOTE]
> The code samples in this document are generated from API usage examples contributed by Resource Providers in their [Azure Rest API specifications](https://github.com/Azure/azure-rest-api-specs). Any issues should be reported and addressed in the source.


## microsoft.servicefabric/managedclusters

Put a cluster with maximum parameters
```bicep
resource exampleResource 'Microsoft.ServiceFabric/managedClusters@2024-11-01-preview' = {
  name: 'example'
  location: 'eastus'
  properties: {
    addonFeatures: [
      'DnsService'
      'BackupRestoreService'
      'ResourceMonitorService'
    ]
    adminPassword: '{vm-password}'
    adminUserName: 'vmadmin'
    allocatedOutboundPorts: 0
    allowRdpAccess: true
    applicationTypeVersionsCleanupPolicy: {
      maxUnusedVersionsToKeep: 3
    }
    autoGeneratedDomainNameLabelScope: 'SubscriptionReuse'
    auxiliarySubnets: [
      {
        name: 'testSubnet1'
        enableIpv6: true
        networkSecurityGroupId: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resRg/providers/Microsoft.Network/networkSecurityGroups/sn1'
        privateEndpointNetworkPolicies: 'enabled'
        privateLinkServiceNetworkPolicies: 'enabled'
      }
    ]
    clientConnectionPort: 19000
    clusterCodeVersion: '7.1.168.9494'
    clusterUpgradeMode: 'Manual'
    ddosProtectionPlanId: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resRg/providers/Microsoft.Network/ddosProtectionPlans/myDDoSProtectionPlan'
    dnsName: 'mycluster'
    enableAutoOSUpgrade: true
    enableHttpGatewayExclusiveAuthMode: true
    enableIpv6: true
    fabricSettings: [
      {
        name: 'ManagedIdentityTokenService'
        parameters: [
          {
            name: 'IsEnabled'
            value: 'true'
          }
        ]
      }
    ]
    httpGatewayConnectionPort: 19080
    httpGatewayTokenAuthConnectionPort: 19081
    ipTags: [
      {
        ipTagType: 'FirstPartyUsage'
        tag: 'SQL'
      }
    ]
    loadBalancingRules: [
      {
        backendPort: 80
        frontendPort: 80
        probePort: 80
        probeProtocol: 'http'
        protocol: 'http'
      }
      {
        backendPort: 443
        frontendPort: 443
        probePort: 443
        probeProtocol: 'http'
        protocol: 'http'
      }
      {
        backendPort: 10000
        frontendPort: 10000
        loadDistribution: 'Default'
        probePort: 10000
        probeProtocol: 'http'
        protocol: 'tcp'
      }
    ]
    networkSecurityRules: [
      {
        name: 'TestName'
        description: 'Test description'
        access: 'allow'
        destinationAddressPrefixes: [
          '*'
        ]
        destinationPortRanges: [
          '*'
        ]
        direction: 'inbound'
        priority: 1010
        sourceAddressPrefixes: [
          '*'
        ]
        sourcePortRanges: [
          '*'
        ]
        protocol: 'tcp'
      }
      {
        name: 'AllowARM'
        access: 'allow'
        destinationAddressPrefix: '*'
        destinationPortRange: '33500-33699'
        direction: 'inbound'
        priority: 2002
        sourceAddressPrefix: 'AzureResourceManager'
        sourcePortRange: '*'
        protocol: '*'
      }
    ]
    publicIPPrefixId: '/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/resRg/providers/Microsoft.Network/publicIPPrefixes/myPublicIPPrefix'
    publicIPv6PrefixId: '/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/resRg/providers/Microsoft.Network/publicIPPrefixes/myPublicIPv6Prefix'
    serviceEndpoints: [
      {
        locations: [
          'eastus2'
          'usnorth'
        ]
        service: 'Microsoft.Storage'
      }
    ]
    upgradeDescription: {
      deltaHealthPolicy: {
        maxPercentDeltaUnhealthyApplications: 40
        maxPercentDeltaUnhealthyNodes: 20
        maxPercentUpgradeDomainDeltaUnhealthyNodes: 40
      }
      forceRestart: false
      healthPolicy: {
        maxPercentUnhealthyApplications: 30
        maxPercentUnhealthyNodes: 10
      }
      monitoringPolicy: {
        healthCheckRetryTimeout: '00:55:00'
        healthCheckStableDuration: '00:45:00'
        healthCheckWaitDuration: '00:05:00'
        upgradeDomainTimeout: '03:00:00'
        upgradeTimeout: '12:00:00'
      }
    }
    useCustomVnet: true
    zonalResiliency: true
    zonalUpdateMode: 'Fast'
  }
  sku: {
    name: 'Basic'
  }
  tags: {
  }
}
```

Put a cluster with minimum parameters
```bicep
resource exampleResource 'Microsoft.ServiceFabric/managedClusters@2024-11-01-preview' = {
  name: 'example'
  location: 'eastus'
  properties: {
    adminPassword: '{vm-password}'
    adminUserName: 'vmadmin'
    clusterUpgradeCadence: 'Wave1'
    clusterUpgradeMode: 'Automatic'
    dnsName: 'myCluster'
    fabricSettings: [
      {
        name: 'ManagedIdentityTokenService'
        parameters: [
          {
            name: 'IsEnabled'
            value: 'true'
          }
        ]
      }
    ]
  }
  sku: {
    name: 'Basic'
  }
}
```

## microsoft.servicefabric/managedclusters/applications

Put an application with maximum parameters
```bicep
resource exampleResource 'Microsoft.ServiceFabric/managedClusters/applications@2024-11-01-preview' = {
  parent: parentResource 
  name: 'example'
  location: 'eastus'
  properties: {
    parameters: {
      param1: 'value1'
    }
    upgradePolicy: {
      applicationHealthPolicy: {
        considerWarningAsError: true
        defaultServiceTypeHealthPolicy: {
          maxPercentUnhealthyPartitionsPerService: 0
          maxPercentUnhealthyReplicasPerPartition: 0
          maxPercentUnhealthyServices: 0
        }
        maxPercentUnhealthyDeployedApplications: 0
        serviceTypeHealthPolicyMap: {
          service1: {
            maxPercentUnhealthyPartitionsPerService: 30
            maxPercentUnhealthyReplicasPerPartition: 30
            maxPercentUnhealthyServices: 30
          }
        }
      }
      forceRestart: false
      instanceCloseDelayDuration: 600
      recreateApplication: false
      rollingUpgradeMonitoringPolicy: {
        failureAction: 'Rollback'
        healthCheckRetryTimeout: '00:10:00'
        healthCheckStableDuration: '00:05:00'
        healthCheckWaitDuration: '00:02:00'
        upgradeDomainTimeout: '00:15:00'
        upgradeTimeout: '01:00:00'
      }
      upgradeMode: 'UnmonitoredAuto'
      upgradeReplicaSetCheckTimeout: 3600
    }
    version: '/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/resRg/providers/Microsoft.ServiceFabric/managedclusters/myCluster/applicationTypes/myAppType/versions/1.0'
  }
  tags: {
    a: 'b'
  }
}
```

Put an application with minimum parameters
```bicep
resource exampleResource 'Microsoft.ServiceFabric/managedClusters/applications@2024-11-01-preview' = {
  parent: parentResource 
  name: 'example'
  location: 'eastus'
  properties: {
    version: '/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/resRg/providers/Microsoft.ServiceFabric/managedclusters/myCluster/applicationTypes/myAppType/versions/1.0'
  }
}
```

## microsoft.servicefabric/managedclusters/applications/services

Put a service with maximum parameters
```bicep
resource exampleResource 'Microsoft.ServiceFabric/managedClusters/applications/services@2024-11-01-preview' = {
  parent: parentResource 
  name: 'example'
  location: 'eastus'
  properties: {
    correlationScheme: [
      {
        scheme: 'AlignedAffinity'
        serviceName: '/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/resRg/providers/Microsoft.ServiceFabric/managedclusters/myCluster/applications/myApp/services/myService1'
      }
    ]
    defaultMoveCost: 'Medium'
    instanceCount: 5
    minInstanceCount: 3
    minInstancePercentage: 30
    partitionDescription: {
      partitionScheme: 'Singleton'
    }
    placementConstraints: 'NodeType==frontend'
    scalingPolicies: [
      {
        scalingMechanism: {
          kind: 'ScalePartitionInstanceCount'
          maxInstanceCount: 9
          minInstanceCount: 3
          scaleIncrement: 2
        }
        scalingTrigger: {
          kind: 'AveragePartitionLoadTrigger'
          lowerLoadThreshold: 2
          metricName: 'metricName'
          scaleInterval: '00:01:00'
          upperLoadThreshold: 8
        }
      }
    ]
    serviceDnsName: 'myservicednsname.myApp'
    serviceKind: 'Stateless'
    serviceLoadMetrics: [
      {
        name: 'metric1'
        defaultLoad: 3
        weight: 'Low'
      }
    ]
    servicePackageActivationMode: 'SharedProcess'
    servicePlacementPolicies: [
      {
        type: 'NonPartiallyPlaceService'
      }
    ]
    serviceTypeName: 'myServiceType'
  }
  tags: {
    a: 'b'
  }
}
```

Put a service with minimum parameters
```bicep
resource exampleResource 'Microsoft.ServiceFabric/managedClusters/applications/services@2024-11-01-preview' = {
  parent: parentResource 
  name: 'example'
  location: 'eastus'
  properties: {
    instanceCount: 1
    partitionDescription: {
      partitionScheme: 'Singleton'
    }
    serviceKind: 'Stateless'
    serviceTypeName: 'myServiceType'
  }
}
```

## microsoft.servicefabric/managedclusters/applicationtypes

Put an application type
```bicep
resource exampleResource 'Microsoft.ServiceFabric/managedClusters/applicationTypes@2024-11-01-preview' = {
  parent: parentResource 
  name: 'example'
  location: 'eastus'
}
```

## microsoft.servicefabric/managedclusters/applicationtypes/versions

Put an application type version
```bicep
resource exampleResource 'Microsoft.ServiceFabric/managedClusters/applicationTypes/versions@2024-11-01-preview' = {
  parent: parentResource 
  name: 'example'
  location: 'eastus'
  properties: {
    appPackageUrl: 'http://fakelink.test.com/MyAppType'
  }
}
```

## microsoft.servicefabric/managedclusters/nodetypes

Put a node type with auto-scale parameters
```bicep
resource exampleResource 'Microsoft.ServiceFabric/managedClusters/nodeTypes@2024-11-01-preview' = {
  parent: parentResource 
  name: 'example'
  properties: {
    capacities: {
      ClientConnections: '65536'
    }
    dataDiskSizeGB: 200
    dataDiskType: 'Premium_LRS'
    isPrimary: false
    isStateless: true
    multiplePlacementGroups: true
    placementProperties: {
      HasSSD: 'true'
      NodeColor: 'green'
      SomeProperty: '5'
    }
    vmExtensions: [
      {
        name: 'Microsoft.Azure.Geneva.GenevaMonitoring'
        properties: {
          type: 'GenevaMonitoring'
          autoUpgradeMinorVersion: true
          publisher: 'Microsoft.Azure.Geneva'
          settings: {
          }
          typeHandlerVersion: '2.0'
        }
      }
    ]
    vmImageOffer: 'WindowsServer'
    vmImagePublisher: 'MicrosoftWindowsServer'
    vmImageSku: '2016-Datacenter-Server-Core'
    vmImageVersion: 'latest'
    vmInstanceCount: -1
    vmManagedIdentity: {
      userAssignedIdentities: [
        '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resRg/providers/Microsoft.ManagedIdentity/userAssignedIdentities/myIdentity'
        '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resRg/providers/Microsoft.ManagedIdentity/userAssignedIdentities/myIdentity2'
      ]
    }
    vmSecrets: [
      {
        sourceVault: {
          id: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resRg/providers/Microsoft.KeyVault/vaults/myVault'
        }
        vaultCertificates: [
          {
            certificateStore: 'My'
            certificateUrl: 'https://myVault.vault.azure.net:443/secrets/myCert/ef1a31d39e1f46bca33def54b6cda54c'
          }
        ]
      }
    ]
    vmSize: 'Standard_DS3'
  }
}
```

Put a node type with maximum parameters
```bicep
resource exampleResource 'Microsoft.ServiceFabric/managedClusters/nodeTypes@2024-11-01-preview' = {
  parent: parentResource 
  name: 'example'
  properties: {
    additionalDataDisks: [
      {
        diskLetter: 'F'
        diskSizeGB: 256
        diskType: 'StandardSSD_LRS'
        lun: 1
      }
      {
        diskLetter: 'G'
        diskSizeGB: 150
        diskType: 'Premium_LRS'
        lun: 2
      }
    ]
    additionalNetworkInterfaceConfigurations: [
      {
        name: 'nic-1'
        dscpConfiguration: {
          id: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resRg/providers/Microsoft.Network/dscpConfigurations/myDscpConfig'
        }
        enableAcceleratedNetworking: true
        ipConfigurations: [
          {
            name: 'ipconfig-1'
            applicationGatewayBackendAddressPools: [
              {
                id: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resRg/providers/Microsoft.Network/applicationGateways/appgw-test/backendAddressPools/appgwBepoolTest'
              }
            ]
            loadBalancerBackendAddressPools: [
              {
                id: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resRg/providers/Microsoft.Network/loadBalancers/test-LB/backendAddressPools/LoadBalancerBEAddressPool'
              }
            ]
            loadBalancerInboundNatPools: [
              {
                id: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resRg/providers/Microsoft.Network/loadBalancers/test-LB/inboundNatPools/LoadBalancerNATPool'
              }
            ]
            privateIPAddressVersion: 'IPv4'
            publicIPAddressConfiguration: {
              name: 'publicip-1'
              ipTags: [
                {
                  ipTagType: 'RoutingPreference'
                  tag: 'Internet'
                }
              ]
              publicIPAddressVersion: 'IPv4'
            }
            subnet: {
              id: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resRg/providers/Microsoft.Network/virtualNetworks/vnet1/subnets/subnet1'
            }
          }
        ]
      }
    ]
    capacities: {
      ClientConnections: '65536'
    }
    computerNamePrefix: 'BE'
    dataDiskLetter: 'S'
    dataDiskSizeGB: 200
    dataDiskType: 'Premium_LRS'
    dscpConfigurationId: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resRg/providers/Microsoft.Network/dscpConfigurations/myDscpConfig'
    enableAcceleratedNetworking: true
    enableEncryptionAtHost: true
    enableNodePublicIP: true
    enableNodePublicIPv6: true
    enableOverProvisioning: false
    evictionPolicy: 'Deallocate'
    frontendConfigurations: [
      {
        applicationGatewayBackendAddressPoolId: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resRg/providers/Microsoft.Network/applicationGateways/appgw-test/backendAddressPools/appgwBepoolTest'
        loadBalancerBackendAddressPoolId: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resRg/providers/Microsoft.Network/loadBalancers/test-LB/backendAddressPools/LoadBalancerBEAddressPool'
        loadBalancerInboundNatPoolId: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resRg/providers/Microsoft.Network/loadBalancers/test-LB/inboundNatPools/LoadBalancerNATPool'
      }
    ]
    isPrimary: false
    isSpotVM: true
    isStateless: true
    multiplePlacementGroups: true
    natGatewayId: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resRg/providers/Microsoft.Network/natGateways/myNatGateway'
    placementProperties: {
      HasSSD: 'true'
      NodeColor: 'green'
      SomeProperty: '5'
    }
    secureBootEnabled: true
    securityEncryptionType: 'DiskWithVMGuestState'
    securityType: 'ConfidentialVM'
    serviceArtifactReferenceId: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resRg/providers/Microsoft.Compute/galleries/myGallery/serviceArtifacts/myServiceArtifact/vmArtifactsProfiles/myVmArtifactProfile'
    spotRestoreTimeout: 'PT30M'
    subnetId: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resRg/providers/Microsoft.Network/virtualNetworks/vnet1/subnets/subnet1'
    useDefaultPublicLoadBalancer: true
    useEphemeralOSDisk: true
    vmApplications: [
      {
        configurationReference: 'https://mystorageaccount.blob.core.windows.net/containername/blobname'
        enableAutomaticUpgrade: true
        order: 1
        packageReferenceId: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resRg/providers/Microsoft.Compute/galleries/myGallery/applications/myApplication/versions/1.0.0'
        treatFailureAsDeploymentFailure: false
        vmGalleryTags: '{"Tag1":"Value1","Tag2":"Value2"}'
      }
    ]
    vmExtensions: [
      {
        name: 'Microsoft.Azure.Geneva.GenevaMonitoring'
        properties: {
          type: 'GenevaMonitoring'
          autoUpgradeMinorVersion: true
          enableAutomaticUpgrade: true
          forceUpdateTag: 'v.1.0'
          publisher: 'Microsoft.Azure.Geneva'
          settings: {
          }
          setupOrder: [
            'BeforeSFRuntime'
          ]
          typeHandlerVersion: '2.0'
        }
      }
    ]
    vmImageOffer: 'WindowsServer'
    vmImagePublisher: 'MicrosoftWindowsServer'
    vmImageSku: '2016-Datacenter-Server-Core'
    vmImageVersion: 'latest'
    vmInstanceCount: 10
    vmManagedIdentity: {
      userAssignedIdentities: [
        '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resRg/providers/Microsoft.ManagedIdentity/userAssignedIdentities/myIdentity'
        '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resRg/providers/Microsoft.ManagedIdentity/userAssignedIdentities/myIdentity2'
      ]
    }
    vmSecrets: [
      {
        sourceVault: {
          id: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resRg/providers/Microsoft.KeyVault/vaults/myVault'
        }
        vaultCertificates: [
          {
            certificateStore: 'My'
            certificateUrl: 'https://myVault.vault.azure.net:443/secrets/myCert/ef1a31d39e1f46bca33def54b6cda54c'
          }
        ]
      }
    ]
    vmSetupActions: [
      'EnableContainers'
      'EnableHyperV'
    ]
    vmSize: 'Standard_DS3'
  }
}
```

Put a node type with minimum parameters
```bicep
resource exampleResource 'Microsoft.ServiceFabric/managedClusters/nodeTypes@2024-11-01-preview' = {
  parent: parentResource 
  name: 'example'
  properties: {
    dataDiskSizeGB: 200
    isPrimary: false
    vmImageOffer: 'WindowsServer'
    vmImagePublisher: 'MicrosoftWindowsServer'
    vmImageSku: '2016-Datacenter-Server-Core'
    vmImageVersion: 'latest'
    vmInstanceCount: 10
    vmSize: 'Standard_D3'
  }
}
```

Put an stateless node type with temporary disk for service fabric
```bicep
resource exampleResource 'Microsoft.ServiceFabric/managedClusters/nodeTypes@2024-11-01-preview' = {
  parent: parentResource 
  name: 'example'
  properties: {
    enableEncryptionAtHost: true
    isPrimary: false
    isStateless: true
    multiplePlacementGroups: true
    useTempDataDisk: true
    vmExtensions: [
      {
        name: 'Microsoft.Azure.Geneva.GenevaMonitoring'
        properties: {
          type: 'GenevaMonitoring'
          autoUpgradeMinorVersion: true
          publisher: 'Microsoft.Azure.Geneva'
          settings: {
          }
          typeHandlerVersion: '2.0'
        }
      }
    ]
    vmImageOffer: 'WindowsServer'
    vmImagePublisher: 'MicrosoftWindowsServer'
    vmImageSku: '2016-Datacenter-Server-Core'
    vmImageVersion: 'latest'
    vmInstanceCount: 10
    vmSize: 'Standard_DS3'
  }
}
```

Put node type with custom vm image
```bicep
resource exampleResource 'Microsoft.ServiceFabric/managedClusters/nodeTypes@2024-11-01-preview' = {
  parent: parentResource 
  name: 'example'
  properties: {
    dataDiskSizeGB: 200
    isPrimary: false
    vmImageResourceId: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-custom-image/providers/Microsoft.Compute/galleries/myCustomImages/images/Win2019DC'
    vmInstanceCount: 10
    vmSize: 'Standard_D3'
  }
}
```

Put node type with dedicated hosts
```bicep
resource exampleResource 'Microsoft.ServiceFabric/managedClusters/nodeTypes@2024-11-01-preview' = {
  parent: parentResource 
  name: 'example'
  properties: {
    capacities: {
    }
    dataDiskSizeGB: 200
    dataDiskType: 'StandardSSD_LRS'
    hostGroupId: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/testhostgroupRG/providers/Microsoft.Compute/hostGroups/testHostGroup'
    isPrimary: false
    placementProperties: {
    }
    vmImageOffer: 'WindowsServer'
    vmImagePublisher: 'MicrosoftWindowsServer'
    vmImageSku: '2019-Datacenter'
    vmImageVersion: 'latest'
    vmInstanceCount: 10
    vmSize: 'Standard_D8s_v3'
    zones: [
      '1'
    ]
  }
}
```

Put node type with shared galleries custom vm image
```bicep
resource exampleResource 'Microsoft.ServiceFabric/managedClusters/nodeTypes@2024-11-01-preview' = {
  parent: parentResource 
  name: 'example'
  properties: {
    dataDiskSizeGB: 200
    isPrimary: false
    vmInstanceCount: 10
    vmSharedGalleryImageId: '/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-custom-image/providers/Microsoft.Compute/sharedGalleries/35349201-a0b3-405e-8a23-9f1450984307-SFSHAREDGALLERY/images/TestNoProdContainerDImage/versions/latest'
    vmSize: 'Standard_D3'
  }
}
```

Put node type with vm image plan 
```bicep
resource exampleResource 'Microsoft.ServiceFabric/managedClusters/nodeTypes@2024-11-01-preview' = {
  parent: parentResource 
  name: 'example'
  properties: {
    dataDiskSizeGB: 200
    isPrimary: false
    vmImageOffer: 'windows_2022_test'
    vmImagePlan: {
      name: 'win_2022_test_20_10_gen2'
      product: 'windows_2022_test'
      publisher: 'testpublisher'
    }
    vmImagePublisher: 'testpublisher'
    vmImageSku: 'win_2022_test_20_10_gen2'
    vmImageVersion: 'latest'
    vmInstanceCount: 10
    vmSize: 'Standard_D3'
  }
}
```
