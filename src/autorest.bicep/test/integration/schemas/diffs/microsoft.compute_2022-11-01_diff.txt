 {
   resourceDefinitions: {
+    virtualMachineScaleSets_extensions: {
+      description: "Microsoft.Compute/virtualMachineScaleSets/extensions"
+      properties: {
+        apiVersion: {
+          enum: [
+            "2022-11-01"
+          ]
+          type: "string"
+        }
+        name: {
+          description: "The name of the VM scale set extension."
+          type: "string"
+        }
+        properties: {
+          description: "Describes the properties of a Virtual Machine Scale Set Extension."
+          oneOf: [
+            {
+              $ref: "#/definitions/VirtualMachineScaleSetExtensionProperties"
+            }
+            {
+              $ref: "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
+            }
+          ]
+        }
+        type: {
+          enum: [
+            "Microsoft.Compute/virtualMachineScaleSets/extensions"
+          ]
+          type: "string"
+        }
+      }
+      required: [
+        "name"
+        "properties"
+        "apiVersion"
+        "type"
+      ]
+      type: "object"
+    }
+    virtualMachines_extensions: {
+      description: "Microsoft.Compute/virtualMachines/extensions"
+      properties: {
+        apiVersion: {
+          enum: [
+            "2022-11-01"
+          ]
+          type: "string"
+        }
+        location: {
+          description: "Resource location"
+          type: "string"
+        }
+        name: {
+          description: "The name of the virtual machine extension."
+          type: "string"
+        }
+        properties: {
+          description: "Describes the properties of a Virtual Machine Extension."
+          oneOf: [
+            {
+              $ref: "#/definitions/VirtualMachineExtensionProperties"
+            }
+            {
+              $ref: "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
+            }
+          ]
+        }
+        tags: {
+          description: "Resource tags"
+          oneOf: [
+            {
+              additionalProperties: {
+                type: "string"
+              }
+              properties: {
+              }
+              type: "object"
+            }
+            {
+              $ref: "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
+            }
+          ]
+        }
+        type: {
+          enum: [
+            "Microsoft.Compute/virtualMachines/extensions"
+          ]
+          type: "string"
+        }
+      }
+      required: [
+        "name"
+        "properties"
+        "apiVersion"
+        "type"
+      ]
+      type: "object"
+    }
     availabilitySets: {
       required: [
         ...
-        "location"
         ...
         ...
         ...
       ]
     }
     capacityReservationGroups: {
       required: [
         ...
-        "location"
         ...
         ...
         ...
       ]
     }
     capacityReservationGroups_capacityReservations: {
       required: [
         ...
-        "location"
         ...
         ...
-        "sku"
         ...
       ]
     }
     hostGroups: {
       required: [
         ...
-        "location"
         ...
         ...
         ...
       ]
     }
     hostGroups_hosts: {
       required: [
         ...
-        "location"
         ...
         ...
-        "sku"
         ...
       ]
     }
     images: {
       required: [
         ...
-        "location"
         ...
         ...
         ...
       ]
     }
     proximityPlacementGroups: {
       required: [
         ...
-        "location"
         ...
         ...
         ...
       ]
     }
     restorePointCollections: {
       required: [
         ...
-        "location"
         ...
         ...
         ...
       ]
     }
     sshPublicKeys: {
       required: [
         ...
-        "location"
         ...
         ...
         ...
       ]
     }
     virtualMachines: {
       required: [
         ...
-        "location"
         ...
         ...
         ...
       ]
     }
     virtualMachineScaleSets: {
       required: [
         ...
-        "location"
         ...
         ...
         ...
       ]
     }
     virtualMachineScaleSets_virtualMachines: {
       required: [
         ...
-        "location"
         ...
         ...
         ...
       ]
     }
     virtualMachineScaleSets_virtualMachines_runCommands: {
       required: [
         ...
-        "location"
         ...
         ...
         ...
       ]
     }
     virtualMachines_runCommands: {
       required: [
         ...
-        "location"
         ...
         ...
         ...
       ]
     }
   }
   definitions: {
     capacityReservationGroups_capacityReservations_childResource: {
       required: [
         ...
-        "location"
         ...
         ...
-        "sku"
         ...
       ]
     }
     hostGroups_hosts_childResource: {
       required: [
         ...
-        "location"
         ...
         ...
-        "sku"
         ...
       ]
     }
     VirtualMachineExtensionProperties: {
       properties: {
         protectedSettings: {
-          type: "object"
-          properties: {
-          }
+          oneOf: [
+            {
+              properties: {
+              }
+              type: "object"
+            }
+            {
+              $ref: "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
+            }
+          ]
         }
         settings: {
-          type: "object"
-          properties: {
-          }
+          oneOf: [
+            {
+              properties: {
+              }
+              type: "object"
+            }
+            {
+              $ref: "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
+            }
+          ]
         }
       }
     }
     VirtualMachineRunCommandProperties: {
       properties: {
         asyncExecution: {
           oneOf: [
             {
-              default: false
             }
             ...
           ]
         }
       }
     }
     VirtualMachineScaleSetExtension: {
       properties: {
         properties: {
-          anyOf: [
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/genericExtension"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/iaaSDiagnostics"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/iaaSAntimalware"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/customScriptExtension"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/customScriptForLinux"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/linuxDiagnostic"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/vmAccessForLinux"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/bgInfo"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/vmAccessAgent"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/dscExtension"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/acronisBackupLinux"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/acronisBackup"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/linuxChefClient"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/chefClient"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/datadogLinuxAgent"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/datadogWindowsAgent"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/dockerExtension"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/dynatraceLinux"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/dynatraceWindows"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/eset"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/hpeSecurityApplicationDefender"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/puppetAgent"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/site24x7LinuxServerExtn"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/site24x7WindowsServerExtn"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/site24x7ApmInsightExtn"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/trendMicroDSALinux"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/trendMicroDSA"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/bmcCtmAgentLinux"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/bmcCtmAgentWindows"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/OSPatchingForLinux"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/VMSnapshot"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/VMSnapshotLinux"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/customScript"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/networkWatcherAgentWindows"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/networkWatcherAgentLinux"
-            }
-          ]
+          oneOf: [
+            {
+              $ref: "#/definitions/VirtualMachineScaleSetExtensionProperties"
+            }
+            {
+              $ref: "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
+            }
+          ]
         }
       }
     }
     VirtualMachineScaleSetExtensionProperties: {
       properties: {
         protectedSettings: {
-          type: "object"
-          properties: {
-          }
+          oneOf: [
+            {
+              properties: {
+              }
+              type: "object"
+            }
+            {
+              $ref: "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
+            }
+          ]
         }
         settings: {
-          type: "object"
-          properties: {
-          }
+          oneOf: [
+            {
+              properties: {
+              }
+              type: "object"
+            }
+            {
+              $ref: "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
+            }
+          ]
         }
       }
     }
     virtualMachineScaleSets_virtualMachines_childResource: {
       required: [
         ...
-        "location"
         ...
         ...
         ...
       ]
     }
     virtualMachineScaleSets_virtualMachines_runCommands_childResource: {
       required: [
         ...
-        "location"
         ...
         ...
         ...
       ]
     }
     virtualMachines_extensions_childResource: {
       properties: {
         properties: {
-          anyOf: [
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/genericExtension"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/iaaSDiagnostics"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/iaaSAntimalware"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/customScriptExtension"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/customScriptForLinux"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/linuxDiagnostic"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/vmAccessForLinux"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/bgInfo"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/vmAccessAgent"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/dscExtension"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/acronisBackupLinux"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/acronisBackup"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/linuxChefClient"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/chefClient"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/datadogLinuxAgent"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/datadogWindowsAgent"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/dockerExtension"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/dynatraceLinux"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/dynatraceWindows"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/eset"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/hpeSecurityApplicationDefender"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/puppetAgent"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/site24x7LinuxServerExtn"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/site24x7WindowsServerExtn"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/site24x7ApmInsightExtn"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/trendMicroDSALinux"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/trendMicroDSA"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/bmcCtmAgentLinux"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/bmcCtmAgentWindows"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/OSPatchingForLinux"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/VMSnapshot"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/VMSnapshotLinux"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/customScript"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/networkWatcherAgentWindows"
-            }
-            {
-              $ref: "https://schema.management.azure.com/schemas/2022-11-01/Microsoft.Compute.Extensions.json#/definitions/networkWatcherAgentLinux"
-            }
-          ]
+          oneOf: [
+            {
+              $ref: "#/definitions/VirtualMachineExtensionProperties"
+            }
+            {
+              $ref: "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
+            }
+          ]
         }
       }
     }
     virtualMachines_runCommands_childResource: {
       required: [
         ...
-        "location"
         ...
         ...
         ...
       ]
     }
   }
 }
